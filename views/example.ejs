<html>
<head>
    <link href="/stylesheets/c3.css" rel="stylesheet" type="text/css">
</head>
<body>
<div id="chart"></div>

<script type="text/javascript" src="/javascripts/jquery.min.js"></script>
<script src="/javascripts/d3.min.js" charset="utf-8"></script>
<script src="/javascripts/c3.min.js"></script>
<script>

    var chart = c3.generate({
        bindto: '#chart',
        data: {
            columns: [
                ['data1', []],
                ['data2', []]
            ],
            type: 'area-step'
        }
    });
    window.setInterval(function(){
        drawChart();
    }, 3000);

    function drawChart() {

        var array1;
        var array2;

        $.get("http://localhost:3000/data", function(reqData) {
            var array = [['Time', 'Consumption', 'Production']];
            array1 = ['data1'];
            array2 = ['data2'];
            array.push(["", 0, 0]);
            var obj = JSON.parse(reqData);
            if (obj == null) {
                array.push(["", 0, 0]);
                console.log("data is null");
            }
            else {
                for (var i in obj) {
//                    console.log(obj[i]);
                    array1.push(parseInt(obj[i].consumption));
                    array2.push(parseInt(obj[i].production));
                    var time = obj[i].time.time.hour + ':' + obj[i].time.time.minute;
                    array.push([time, obj[i].consumption, obj[i].production]);
                }
            }

            console.log(array1);
            console.log(array2);

            chart.load({
                columns: [
                    array1,
                    array2
                ]
            });
        });
    }
</script>
</body>
</html>