<html>
<head>
    <link href="/stylesheets/c3.css" rel="stylesheet" type="text/css">
    <link rel="stylesheet" href="/stylesheets/bootstrap.min.css">
    <link rel="stylesheet" href="/stylesheets/style.css" />
</head>
<body>

<script type="text/javascript" src="/javascripts/jquery.min.js"></script>
<script type="text/javascript" src="/javascripts/bootstrap.min.js"></script>
<script src="/javascripts/d3.min.js" charset="utf-8"></script>
<script src="/javascripts/c3.min.js"></script>
<script type="text/javascript" src="/javascripts/sessionVariables.js"></script>

<div class="row-fluid">
    <div class="col-sm-12">
        <div class="col-sm-2">
            <a href="http://localhost:3000/">
                <button type="button" class="btn btn-primary">
                    <span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>
                    Back
                </button>
            </a>
            <br /> <br />
            <button id="stop" onclick="stopSimulation();" type="button" class="btn btn-danger">
                <span class="glyphicon glyphicon-stop" aria-hidden="true"></span>
                Stop
            </button>
        </div>
        <div class="col-sm-10 ac">
            <ul class="nav nav-tabs nav-justified">
                <li>
                    <button onclick="changeToAreaChart();" type="button" class="btn btn-primary">
                        <span class="glyphicon glyphicon-stats" aria-hidden="true"></span>
                        Area chart
                    </button>
                </li>
                <li>
                    <button onclick="changeToLineChart();" type="button" class="btn btn-primary">
                        <span class="glyphicon glyphicon-stats" aria-hidden="true"></span>
                        Line chart
                    </button>
                </li>
                <li>
                    <button onclick="changeToPieChart();" type="button" class="btn btn-primary">
                        <span class="glyphicon glyphicon-stats" aria-hidden="true"></span>
                        Pie chart
                    </button>
                </li>
                <li>
                    <button onclick="changeToBarChart();" type="button" class="btn btn-primary">
                        <span class="glyphicon glyphicon-stats" aria-hidden="true"></span>
                        Bar chart
                    </button>
                </li>
            </ul>
            <br /> <br />
            <div id="chart" style="height: 80%; width: 100%;"></div>
        </div>
    </div>
</div>

<script>

    var chart = c3.generate({
        bindto: '#chart',
        data: {
            columns: [
                ['data1', []],
                ['data2', []]
            ],
            type: 'area-step'
        },
        grid: {
            x: {
                show: true
            },
            y: {
                show: true
            }
        },
        tooltip: {
            grouped: false // Default true
        }
    });

    window.setInterval(function(){
        drawChart();
    }, 3000);

    $( document ).ready(function() {
        var sim = getSessionSimulation();
        if (sim != undefined && sim != null && sim != 'null') {
            $('#stop').prop('disabled', false);
        }
        else {
            $('#stop').prop('disabled', true);
        }
    });

    function stopSimulation() {
        $.post('http://localhost:3000/stop');
        $('#stop').prop('disabled', true);
        setSessionSimulation(null);
    }

    function changeToAreaChart() {
        chart.transform('area-step');
    }

    function changeToLineChart() {
        chart.transform('line');
    }

    function changeToBarChart() {
        chart.transform('bar');
    }

    function changeToPieChart() {
        chart.transform('pie');
    }

    function drawChart() {
        $.get("http://localhost:3000/data", function(reqData) {
            var array1 = ['data1'];
            var array2 = ['data2'];
            var obj = JSON.parse(reqData);
            for (var i in obj) {
                array1.push(parseInt(obj[i].consumption));
                array2.push(parseInt(obj[i].production));
                var time = obj[i].time.time.hour + ':' + obj[i].time.time.minute;
            }
            chart.load({
                columns: [
                    array1,
                    array2
                ]
            });
        });
    }
</script>
</body>
</html>