<html>
<head>
    <link href="/stylesheets/c3.css" rel="stylesheet" type="text/css">
    <link rel="stylesheet" href="/stylesheets/bootstrap.min.css">
    <link rel="stylesheet" href="/stylesheets/style.css" />
    <script type="text/javascript" src="/javascripts/jquery.min.js"></script>
    <script type="text/javascript" src="/javascripts/bootstrap.min.js"></script>
    <script src="/javascripts/d3.min.js" charset="utf-8"></script>
    <script src="/javascripts/c3.min.js"></script>
    <script type="text/javascript" src="/javascripts/sessionVariables.js"></script>
</head>
<body>
<div class="row-fluid">
    <div class="col-sm-12">
        <div class="col-sm-2">
            <a href="<%= address %>/village">
                <button type="button" class="btn btn-primary">
                    <span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>
                    Back
                </button>
            </a>
        </div>
        <div class="col-sm-10 ac">
            <ul class="nav nav-tabs nav-justified">
            	<li>
                    <button onclick="changeToStepChartChart();" type="button" class="btn btn-primary">
                        <span class="glyphicon glyphicon-stats" aria-hidden="true"></span>
                        Step Chart
                    </button>
                </li>
                <li>
                    <button onclick="changeToBarChart();" type="button" class="btn btn-primary">
                        <span class="glyphicon glyphicon-stats" aria-hidden="true"></span>
                        Pie Chart
                    </button>
                </li>
                <li>
                    <button type="button" class="btn btn-primary">
                        <span class="glyphicon glyphicon-home" aria-hidden="true"></span>
                        SMG Lab - Live
                    </button>
                </li>
            </ul>
            <br /> <br />
            <div id="chart" style="height: 80%; width: 100%;"></div>
        </div>
    </div>
</div>

<img src="/images/fortiss.png" class="ad" alt="">

<script>

    var chart = c3.generate({
        bindto: '#chart',
        data: {
            columns: [
                ['SMG Production', []],
                ['SMG Consumption', []]
            ],
            type: 'area-step'
        },
        axis: {
            y:{
                show: true,
                label: 'Power in kW'
            },
            x:{
                label: {
                    text: 'SMG production / SMG consumption',
                    position: 'outer-center',
                }
            }
        },
        grid: {
            x: {
                show: true
            },
            y: {
                show: true
            }
        },
        tooltip: {
            grouped: false // Default true
        }
    });

    window.setInterval(function(){
        drawChart();
    }, 3000);

    function changeToBarChart() {
    	option = 2;
    	change = 1;
    }

    function changeToStepChartChart() {
    	option = 1;
    	change = 1;
    }

    // 1 - for step chart
    // 2 - for bar chart
    var option = 1;
    var change = 0;

    function drawChart() {
    	if (option == 1) {
    		$.get("<%= address %>/data/", function(data) {
	            // Used production
	            var array1 = ['SMG Production'];
	            var array2 = ['SMG Consumption'];

	            var obj = JSON.parse(data);
	            for (var i in obj) {
	            	array1.push(parseInt(obj[i].village.village.smgProduction));
	                array2.push(parseInt(obj[i].village.village.smgConsumption));
	                var time = obj[i].time.time.hour + ':' + obj[i].time.time.minute;
	            }

	            chart.load({
	                columns: [
	                    array1,
	                    array2
	                ]
	            });
	        });
	        if (change == 1) {
	        	 chart.transform('area-step');
	        	 change = 0;
	        }
    	}
        else if (option == 2) {
        	$.get("<%= address %>/data/village", function(data) {
	            // Used production
	            var array1 = ['SMG Production'];
	            var array2 = ['SMG Consumption'];

	            array1.push(parseInt(data.village.smgProduction));
	            array2.push(parseInt(data.village.smgConsumption));

	            chart.load({
	                columns: [
	                    array1,
	                    array2
	                ]
	            });
	        });
	        if (change == 1) {
	        	chart.transform('pie');
	        	change = 0;
	    	}	
        }
    }
</script>
</body>
</html>